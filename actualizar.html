<!DOCTYPE html>
<html>
<head>
    <title>Actualizar Producto</title>
</head>
<body>
    <h1>Actualizar Producto</h1>

    <form id="productForm">
        <input type="hidden" id="productId" name="productId">
        
        <label for="nombre">Nombre del Producto:</label>
        <input type="text" id="nombre" name="nombre" required>
        
        <label for="precio">Precio:</label>
        <input type="text" id="precio" name="precio" required>
        
        <label for="descripcion">Descripción:</label>
        <input type="text" id="descripcion" name="descripcion" required>

        <button type="button" id="actualizar">Actualizar</button>
        <button type="button" id="eliminar">Eliminar</button>
    </form>

    <script>
        const productIdInput = document.getElementById('productId');
        const nombreInput = document.getElementById('nombre');
        const precioInput = document.getElementById('precio');
        const descripcionInput = document.getElementById('descripcion');
        const productForm = document.getElementById('productForm');

        const urlParams = new URLSearchParams(window.location.search);
        const productName = urlParams.get('nombre');

        fetch(`https://siaweb-nodejs.carlos-reneren7.repl.co/productos?nombre=${productName}`)
            .then(response => response.json())
            .then(product => {
                if (product.id) {
                    productIdInput.value = product.id;
                    nombreInput.value = product.nombre;
                    precioInput.value = product.precio;
                    descripcionInput.value = product.descripcion;
                } else {
                    alert('No se encontró un producto con ese nombre.');
                    window.location.href = 'index.html';
                }
            })
            .catch(error => console.error(error));

        document.getElementById('actualizar').addEventListener('click', () => {
            const productId = productIdInput.value;
            const nombre = nombreInput.value;
            const precio = precioInput.value;
            const descripcion = descripcionInput.value;

            if (nombre !== '' && precio !== '') {
                const productoActualizado = {
                    id: productId,
                    nombre,
                    precio,
                    descripcion,
                };

                fetch(`https://siaweb-nodejs.carlos-reneren7.repl.co/productos/${productId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(productoActualizado),
                })
                .then(response => {
                    if (response.status === 200) {
                        alert('Producto actualizado con éxito.');
                        window.location.href = 'index.html';
                    } else {
                        alert('Hubo un error al actualizar el producto.');
                    }
                })
                .catch(error => console.error(error));
            }
        });

        document.getElementById('eliminar').addEventListener('click', () => {
            if (confirm('¿Seguro que deseas eliminar este producto?')) {
                const productId = productIdInput.value;

                fetch(`https://siaweb-nodejs.carlos-reneren7.repl.co/productos/${productId}`, {
                    method: 'DELETE',
                })
                .then(response => {
                    if (response.status === 204) {
                        alert('Producto eliminado con éxito.');
                        window.location.href = 'index.html';
                    } else {
                        alert('Hubo un error al eliminar el producto.');
                    }
                })
                .catch(error => console.error(error));
            }
        });
    </script>
</body>
</html>
